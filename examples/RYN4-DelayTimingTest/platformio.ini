; PlatformIO Project Configuration File
;
; RYN4 DELAY Command Timing Test
;
; Minimal example to test DELAY command timing and readback behavior
; Tests whether there's inherent hardware delay between command and state reflection

[platformio]
default_envs = dev_debug_selective

; -------------------------------------------------------------------
; Shared Environment Settings
[env_defaults]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
framework = arduino
board = esp32dev

; Serial port - adjust for your system
monitor_port = /dev/ttyACM1
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, direct, colorize

; Library dependency finder mode
lib_ldf_mode = deep+

; Use local libraries from sibling directories (parent git folder)
lib_extra_dirs = ../../..

; Library dependencies (use symlinks to local repos)
lib_deps =
    ; Foundation
    ESP32-LibraryCommon=symlink://../../../ESP32-LibraryCommon
    ESP32-Logger=symlink://../../../ESP32-Logger
    ESP32-SemaphoreGuard=symlink://../../../ESP32-SemaphoreGuard
    ESP32-MutexGuard=symlink://../../../ESP32-MutexGuard

    ; Task and system management
    ESP32-Watchdog=symlink://../../../ESP32-Watchdog
    ESP32-TaskManager=symlink://../../../ESP32-TaskManager

    ; Modbus framework
    esp32ModbusRTU=symlink://../../../esp32ModbusRTU
    ESP32-IDeviceInstance=symlink://../../../ESP32-IDeviceInstance
    ESP32-ModbusDevice=symlink://../../../ESP32-ModbusDevice

    ; RYN4 library (use local source from parent directory)
    ESP32-RYN4=symlink://../..

; Ignore libraries that might conflict
lib_ignore =
    WiFi

; -------------------------------------------------------------------
; Base build flags
[base]
build_flags =
    -Wall
    -std=gnu++11

    ; Minimal flags - no Ethernet needed for this test
    -D ARDUINO_USB_MODE=0
    -D ARDUINO_USB_CDC_ON_BOOT=0

    ; Optimization
    -O2
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections

    ; Logger configuration
    -D USE_CUSTOM_LOGGER=1
    -D LOG_INTERFACE_BACKEND_LOGGING=1

; -------------------------------------------------------------------
; Debug Selective Environment (recommended)
[env:dev_debug_selective]
extends = env_defaults

build_flags =
    ${base.build_flags}
    -D LOG_MODE_DEBUG_SELECTIVE=1

    ; RYN4 debug output
    -D RYN4_LOG_LEVEL=3      ; DEBUG level

    ; Modbus debug
    -D MODBUS_DEBUG=1

upload_port = /dev/ttyACM1
upload_speed = 460800

; -------------------------------------------------------------------
; Debug Full Environment (maximum verbosity)
[env:dev_debug_full]
extends = env_defaults

build_flags =
    ${base.build_flags}
    -D LOG_MODE_DEBUG_FULL=1

    ; Maximum RYN4 debug output
    -D RYN4_LOG_LEVEL=4      ; VERBOSE level
    -D RYN4_LOG_TIMING=1     ; Timing measurements

    ; Modbus debug
    -D MODBUS_DEBUG=1
    -D MODBUS_LOG_PACKETS=1

upload_port = /dev/ttyACM1
upload_speed = 460800

; -------------------------------------------------------------------
; Release Environment (minimal output)
[env:release]
extends = env_defaults

build_flags =
    ${base.build_flags}
    -D LOG_MODE_RELEASE=1

    ; Minimal RYN4 logging
    -D RYN4_LOG_LEVEL=1      ; ERROR only

upload_port = /dev/ttyACM1
upload_speed = 460800
